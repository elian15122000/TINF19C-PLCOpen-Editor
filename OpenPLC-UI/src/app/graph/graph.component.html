<div style="margin-top: 10px; margin-bottom: 5px;">

  <!-- <app-library></app-library> -->
  <button class="btn btn-outline-primary" (click)="updateChart()">Update Chart</button>
  <button (click)="test()">Test Change Ref</button>
</div>

<div *ngFor="let con of selectedNodeCons; let i = index" >
  <div *ngIf="con.type==='IN'">
    {{con.targetPoint}}:
    <select [(ngModel)]="ConnectionPoint" (ngModelChange)="connect_points($event, con)">
      <option disable selected value></option>
      <option *ngFor="let selectable_con of allConnectionPointOuts; let i = index" [ngValue]="selectable_con">
        {{selectable_con.sourceName}} -- {{selectable_con.sourcePoint}}
      </option>
    </select>
  </div>
  <div *ngIf="con.type==='OUT'">
    {{con.sourcePoint}}:
    <select [(ngModel)]="ConnectionPoint" (ngModelChange)="connect_points(con, $event)">
      <option disable selected value></option>
      <option *ngFor="let selectable_con of allConnectionPointIns; let i = index" [ngValue]="selectable_con">
        {{selectable_con.targetName}} -- {{selectable_con.targetPoint}}
      </option>
    </select>
  </div>
</div>


<ngx-graph class="chart-container" [update$]="update$" [view]="[2000, 800]" [links]="edges" [nodes]="nodes"
  [curve]="curve">
  <ng-template #nodeTemplate let-node>
    <svg:g (click)="set_selected_node(node)">

      <!-- The down-Fork Template -->
      <!-- The width of the strokes need to be made thiner -->
      <svg:g class="node" *ngIf="node.type=='fork'">
        <svg:rect [attr.width]="70" [attr.height]="5" [attr.fill]="'black'" />
        <svg:rect [attr.x]="0" [attr.y]="5" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65" [attr.y]="5" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65/2" [attr.y]="-20" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
      </svg:g>

      <!-- The down-Fork Template -->
      <!-- The width of the strokes need to be made thiner -->
      <svg:g class="node" *ngIf="node.type=='down-fork'">
        <svg:rect [attr.width]="70" [attr.height]="5" [attr.fill]="'black'" />
        <svg:rect [attr.x]="0" [attr.y]="5" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65" [attr.y]="5" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65/2" [attr.y]="-20" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
      </svg:g>

      <!-- The Up-Fork Template -->
      <!-- The width of the strokes need to be made thiner -->
      <svg:g class="node" *ngIf="node.type=='up-fork'">
        <svg:rect [attr.width]="70" [attr.height]="5" [attr.fill]="'black'" />
        <svg:rect [attr.x]="0" [attr.y]="-20" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65" [attr.y]="-20" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
        <svg:rect [attr.x]="65/2" [attr.y]="0" [attr.width]="5" [attr.height]="20" [attr.fill]="'black'" />
      </svg:g>


      <!-- The FBS Template -->
      <!-- The Height ist 40 * number of related edges -->
      <svg:g class="node" *ngIf="node.type=='fbs'">
        <svg:rect [attr.width]="node.dimension.width" [attr.height]="40 * get_related_edges(node.id).length + 50"
          [attr.fill]="'white'" [attr.stroke]='"black"' />
        <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height/2">
          {{node.label}}
        </svg:text>
      </svg:g>

      <!-- The Variable Template -->
      <svg:g class="node" *ngIf="node.type=='var'">
        <svg:rect [attr.width]="node.dimension.width" [attr.height]="node.dimension.height" [attr.fill]="'white'"
          [attr.stroke]='"black"' />
        <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height/2">
          {{node.label}}
        </svg:text>
      </svg:g>

      <svg:g class="node" *ngIf="node.type=='kaka'">
        <svg:rect [attr.width]="node.dimension.width" [attr.height]="node.dimension.height"
          [attr.fill]="node.data.color" />
        <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">
          {{node.label}}
        </svg:text>
      </svg:g>

    </svg:g>
  </ng-template>


  <ng-template #linkTemplate let-link>
    <svg:g class="edge">
      <svg:path class="line" stroke-width="2"></svg:path>
      <svg:text class="edge-label" text-anchor="middle">
        <textPath class="text-path" [attr.href]="'#' + link.id" [style.dominant-baseline]="link.dominantBaseline">
        </textPath>
      </svg:text>
    </svg:g>
  </ng-template>
</ngx-graph>
